<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Snake — HTML5 Canvas</title>
  <style>
    :root { --bg:#0f172a; --board:#111827; --grid:#1f2937; --snake:#10b981; --snakeHead:#34d399; --food:#f43f5e; --text:#e5e7eb; }
    *{box-sizing:border-box}
    body{margin:0;min-height:100vh;display:grid;place-items:center;background:radial-gradient(1200px 800px at 10% 10%,#0b1226 0%,#0f172a 60%,#0b1020 100%);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:var(--text)}
    .wrap{width:min(92vw,520px);display:flex;flex-direction:column;gap:12px;align-items:center}
    h1{font-weight:700;font-size:clamp(18px,2.6vw,22px);margin:0;letter-spacing:.4px}
    .hud{display:flex;gap:14px;align-items:center;flex-wrap:wrap;justify-content:center}
    .tag{background:#0b1222;border:1px solid #1f2a44;color:#cbd5e1;padding:6px 10px;border-radius:999px;font-size:13px}
    canvas{background:var(--board);width:100%;height:auto;border-radius:18px;box-shadow:0 20px 60px rgba(0,0,0,.35), inset 0 0 0 1px #1f2937}
    .controls{display:grid;grid-template-columns:repeat(3,64px);gap:10px;margin:6px 0 2px}
    .controls button{appearance:none;touch-action:manipulation;background:#0b1222;border:1px solid #1f2a44;color:#e5e7eb;border-radius:12px;padding:12px;font-size:16px}
    .controls button:active{transform:translateY(1px)}
    .footer{opacity:.7;font-size:12px}
    @media (pointer:fine){ .controls{display:none} }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Snake</h1>
    <div class="hud">
      <span class="tag">Score: <b id="score">0</b></span>
      <span class="tag">Best: <b id="best">0</b></span>
      <span class="tag">Speed: <b id="speed">1x</b></span>
      <span class="tag">Press ␣ to pause, R to restart</span>
    </div>

    <canvas id="game" width="480" height="480" aria-label="Snake game board" role="img"></canvas>

    <div class="controls" aria-label="Touch controls">
      <div></div>
      <button id="up">▲</button>
      <div></div>
      <button id="left">◀</button>
      <button id="down">▼</button>
      <button id="right">▶</button>
    </div>

    <div class="hud">
      <button class="tag" id="toggleWrap">Walls: On</button>
      <button class="tag" id="speedBtn">Speed ×1</button>
      <button class="tag" id="restart">Restart</button>
    </div>

    <div class="footer">Arrow keys to move. Avoid walls and yourself.
    </div>
  </div>

  <script>
    // Config
    const CELL = 24;
    const COLS = 20;
    const ROWS = 20;

    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const dpr = Math.max(1, Math.floor(window.devicePixelRatio || 1));
    function resizeCanvas(){
      canvas.width  = COLS * CELL * dpr;
      canvas.height = ROWS * CELL * dpr;
      canvas.style.width = '100%';
      ctx.setTransform(dpr,0,0,dpr,0,0);
    }
    resizeCanvas();

    const scoreEl = document.getElementById('score');
    const bestEl  = document.getElementById('best');
    const speedEl = document.getElementById('speed');
    const toggleWrapBtn = document.getElementById('toggleWrap');
    const speedBtn = document.getElementById('speedBtn');
    const restartBtn = document.getElementById('restart');

    const BEST_KEY = 'snake_best_v1';
    bestEl.textContent = localStorage.getItem(BEST_KEY) || 0;

    let snake, dir, nextDir, food, score, paused, over, wrapWalls, speedIndex;
    const speeds = [200, 170, 150, 130, 110]; // slower speeds

    function init(){
      snake = [ {x:Math.floor(COLS/2), y:Math.floor(ROWS/2)}, {x:Math.floor(COLS/2)-1, y:Math.floor(ROWS/2)}, {x:Math.floor(COLS/2)-2, y:Math.floor(ROWS/2)} ];
      dir = {x:1, y:0};
      nextDir = {x:1, y:0};
      score = 0; paused = false; over = false;
      wrapWalls = false; speedIndex = 0;
      spawnFood();
      updateHUD();
    }

    function spawnFood(){
      while(true){
        const fx = Math.floor(Math.random()*COLS);
        const fy = Math.floor(Math.random()*ROWS);
        if(!snake.some(s=>s.x===fx && s.y===fy)){ food = {x:fx, y:fy}; break; }
      }
    }

    function updateHUD(){
      scoreEl.textContent = score;
      speedEl.textContent = (speedIndex+1)+'x';
      toggleWrapBtn.textContent = 'Walls: ' + (wrapWalls ? 'Off' : 'On');
      speedBtn.textContent = 'Speed ×' + (speedIndex+1);
    }

    function gameOver(){
      over = true; paused = true;
      const best = Math.max(Number(localStorage.getItem(BEST_KEY)||0), score);
      localStorage.setItem(BEST_KEY, best);
      bestEl.textContent = best;
      draw(true);
    }

    function tick(){
      if(paused) return;
      if((nextDir.x !== -dir.x || nextDir.y !== -dir.y)) dir = nextDir;
      const head = { x: snake[0].x + dir.x, y: snake[0].y + dir.y };
      if(wrapWalls){
        head.x = (head.x + COLS) % COLS;
        head.y = (head.y + ROWS) % ROWS;
      }
      if(!wrapWalls && (head.x<0 || head.x>=COLS || head.y<0 || head.y>=ROWS)) return gameOver();
      if(snake.some(s=>s.x===head.x && s.y===head.y)) return gameOver();
      snake.unshift(head);
      if(head.x === food.x && head.y === food.y){
        score += 10; spawnFood();
      } else {
        snake.pop();
      }
      draw();
    }

    function draw(showGameOver=false){
      ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--board');
      ctx.fillRect(0,0,COLS*CELL,ROWS*CELL);
      ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--grid');
      ctx.lineWidth = 1;
      for(let x=1;x<COLS;x++){ ctx.beginPath(); ctx.moveTo(x*CELL+.5,0); ctx.lineTo(x*CELL+.5,ROWS*CELL); ctx.stroke(); }
      for(let y=1;y<ROWS;y++){ ctx.beginPath(); ctx.moveTo(0,y*CELL+.5); ctx.lineTo(COLS*CELL,y*CELL+.5); ctx.stroke(); }
      drawCell(food.x, food.y, '--food');
      for(let i=snake.length-1;i>=0;i--){
        drawCell(snake[i].x, snake[i].y, i===0?'--snakeHead':'--snake');
      }
      if(showGameOver){
        ctx.save();
        ctx.fillStyle = 'rgba(0,0,0,.55)';
        ctx.fillRect(0,0,COLS*CELL,ROWS*CELL);
        ctx.fillStyle = '#fff';
        ctx.textAlign = 'center';
        ctx.font = 'bold 28px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif';
        ctx.fillText('Game Over', COLS*CELL/2, ROWS*CELL/2 - 8);
        ctx.font = '16px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif';
        ctx.fillText('Press R to restart', COLS*CELL/2, ROWS*CELL/2 + 18);
        ctx.restore();
      }
    }

    function drawCell(x,y,varName){
      const r = 6;
      const px = x*CELL, py=y*CELL;
      ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue(varName);
      roundRect(ctx, px+3, py+3, CELL-6, CELL-6, r);
      ctx.fill();
    }

    function roundRect(ctx, x, y, w, h, r){
      ctx.beginPath();
      ctx.moveTo(x+r, y);
      ctx.arcTo(x+w, y, x+w, y+h, r);
      ctx.arcTo(x+w, y+h, x, y+h, r);
      ctx.arcTo(x, y+h, x, y, r);
      ctx.arcTo(x, y, x+w, y, r);
      ctx.closePath();
    }

    window.addEventListener('keydown', (e)=>{
      const k = e.key;
      if(k==='ArrowUp'   && dir.y!== 1) nextDir={x:0,y:-1};
      if(k==='ArrowDown' && dir.y!==-1) nextDir={x:0,y: 1};
      if(k==='ArrowLeft' && dir.x!== 1) nextDir={x:-1,y:0};
      if(k==='ArrowRight'&& dir.x!==-1) nextDir={x: 1,y:0};
      if(k===' '){ paused = !paused; draw(); }
      if(k==='r' || k==='R'){ init(); draw(); }
      e.preventDefault();
    }, {passive:false});

    document.getElementById('up').onclick    = ()=>{ if(dir.y!== 1) nextDir={x:0,y:-1}; };
    document.getElementById('down').onclick  = ()=>{ if(dir.y!==-1) nextDir={x:0,y: 1}; };
    document.getElementById('left').onclick  = ()=>{ if(dir.x!== 1) nextDir={x:-1,y:0}; };
    document.getElementById('right').onclick = ()=>{ if(dir.x!==-1) nextDir={x: 1,y:0}; };

    toggleWrapBtn.onclick = ()=>{ wrapWalls=!wrapWalls; updateHUD(); };
    speedBtn.onclick = ()=>{ speedIndex = (speedIndex+1)%speeds.length; updateHUD(); };
    restartBtn.onclick = ()=>{ init(); draw(); };

    init();
    draw();

    let prev = 0, acc = 0;
    function loop(ts){
      const dt = ts - prev; prev = ts; acc += dt;
      const interval = speeds[speedIndex];
      while(acc >= interval){ acc -= interval; tick(); }
      requestAnimationFrame(loop);
    }
    requestAnimationFrame(loop);

    let resizeId;
    window.addEventListener('resize', ()=>{
      clearTimeout(resizeId);
      resizeId = setTimeout(()=>{ resizeCanvas(); draw(); }, 120);
    });
  </script>
</body>
</html>
